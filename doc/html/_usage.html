<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>RKH: Representing a state machine \e step \e by \e step</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="Usage">Representing a state machine <em>step</em> <em>by</em> <em>step</em> </a></h1><p><br/>
 As stated above, RKH is a generic, flexible, modular, highly portable, ANSI-C compliant, and open-source development tool for implementing hierarchical state machines based on modern state machine concepts. This modern techniques are used to give an abstract description of the dynamic behavior of a system in a substantial manner.</p>
<p><b> The key features of the RKH framework: </b></p>
<ul>
<li>State machines representation is based on state tables.</li>
<li>Representing a state machine with RKH is intuitive, and easy.</li>
<li>Reflects the state diagram without obfuscation.</li>
<li>The RKH application are highly maintainable.</li>
<li>Easy to integrate with any event queuing and dispatching mechanism.</li>
<li>Useful in embedded systems.</li>
<li>The most of the RKH implementation is <a class="el" href="_porting.html">independent of any particular CPU, operating system, or compiler</a>.</li>
<li>Flexible and <a class="el" href="cfg.html">user-configurable code generation</a>.</li>
<li>Very small footprint.</li>
<li>Support hierarchically nested states, and flat state machine.</li>
<li>Support conditional, junction, and history pseudostates.</li>
<li>Support compound transitions with guards.</li>
<li>Support local transitions.</li>
<li>Support mechanism for <a class="el" href="rkh_8h.html#af359d4e8f6cec6ca30f5797ee263af52">deferring events</a>.</li>
<li>Support <a class="el" href="struct_r_k_h_e_v_t___t.html">dynamic events</a>.</li>
<li>Support a easy way to use <a class="el" href="struct_r_k_h_e_v_t___t.html">events with arguments</a>.</li>
<li>Support systems-friendly <a class="el" href="rkhitl_8h.html#a701f7ea7c001444bc1ec0052c4a85c8b">assertion</a> macros.</li>
<li>Support <a class="el" href="struct_r_k_h_e_v_t___t.html">event dispatching with parameters</a>.</li>
</ul>
<p>The RKH not implements neither entire UML specs. nor entire Statechart specs. Instead, the RKH intention is to support just enough basic concepts of that powerful tools to facilitate the reactive-system modeling holding a solid, and efficient implementation. Broadly speaking, the RKH implementation has been designed from the ground up to be used in 8-bits platforms but can be easily adapted to 16 or 32-bits platforms.</p>
<p>The goal in this section is to explain how to represent a state machine using the RKH framework. To do that is proposed a simple example, which is shown in the <a class="el" href="_usage.html#fig1">Figure 1</a>.</p>
<p><br/>
 <a class="anchor" id="fig1"></a> </p>
<div align="center">
<img src="my.jpg" alt="my.jpg"/>
<p><strong>Figure 1 - "my" State diagram</strong></p></div>
<p> <br/>
 This section summarizes the main rules and concepts for making the most out of RKH features.</p>
<ul>
<li><a class="el" href="_usage.html#rep0">Preparing the application files</a></li>
<li><a class="el" href="_usage.html#rep1">Identify and classify states and pseudostates</a></li>
<li><a class="el" href="_usage.html#rep2">Representing the state machine</a></li>
<li><a class="el" href="_usage.html#rep3">Running</a></li>
</ul>
<hr/>
 <h2><a class="anchor" id="rep0">
Preparing the application files</a></h2>
<p>The sample code for the example presented above port to x86 is located in the directory \demo\vc08\. The directory contains the Visual C++ 2008 project files to build the application. See <a class="el" href="_installation.html">Installation</a> section about RKH files. The application files are listed below:</p>
<ul>
<li><b>"rkhcfg.h"</b>: this file adapts and configures RKH. See <a class="el" href="cfg.html">Configuration</a> section. In the \demo directory there are other <b><a class="el" href="rkhcfg_8h.html" title="RKH configuration file.">rkhcfg.h</a></b> files already in existence and it's suggested that these are used as a reference. See the application <a class="el" href="rkhcfg__h.html">"rkhcfg.h"</a> file. Note that this file is located in the application directory.</li>
</ul>
<ul>
<li><b>"my.c"</b>: this module implements the "my" state machine, which illustrates all aspects of implementing state machines with RKH framework. Please correlate this implementation with the "my" state diagram in <a class="el" href="_usage.html#fig1">Figure 1</a>. See the <a class="el" href="my__c.html">"my.c"</a> file. Note that this file is located in the application directory.</li>
</ul>
<ul>
<li><b>"myact.c"</b>: this module declares each of entry, exit, transition, and guard actions to be executed. Note that the <b><a class="el" href="rkhcfg_8h.html" title="RKH configuration file.">rkhcfg.h</a></b> file defines the function prototype of actions. See <a class="el" href="cfg.html">Configuration</a> section about of available options and <a class="el" href="myact__c.html">"myact.c"</a> file. Note that this file is located in the application directory.</li>
</ul>
<ul>
<li><b>"my.h"</b>: this header file contains the definitions of objet structures (state machine, states, and pseudostates) and other facilities shared among the components of the application. See the <a class="el" href="my__h.html">"my.h"</a> file. Note that this file is located in the application directory.</li>
</ul>
<ul>
<li><b>"myact.h"</b>: this header file defines the actions to be executed. Note that the <b><a class="el" href="rkhcfg_8h.html" title="RKH configuration file.">rkhcfg.h</a></b> file defines the function prototype of actions. See <a class="el" href="cfg.html">Configuration</a> section about of available options and <a class="el" href="myact__c.html">"myact.c"</a> file. See the <a class="el" href="myact__h.html">"myact.h"</a> file. Note that this file is located in the application directory.</li>
</ul>
<ul>
<li><b>"myevt.h"</b>: because events are explicitly shared among most of the application components, it's convenient to declare them in the separate header file "myevt.h". See the <a class="el" href="myevt__h.html">"myevt.h"</a> file. Note that this file is located in the application directory.</li>
</ul>
<ul>
<li><b>"main.c"</b>: this file contains the <code>main()</code> function along with an example for using the RKH trace facility. See the <a class="el" href="main__c.html">"main.c"</a> file. Note that this file is located in the application directory.</li>
</ul>
<hr/>
 <h2><a class="anchor" id="rep1">
Identify and classify states and pseudostates</a></h2>
<p>The <a class="el" href="_usage.html#fig2">Figure 2</a> shows the states and pseudostates from the diagram presented above, sorted by state nesting level.</p>
<p><br/>
 <a class="anchor" id="fig2"></a> </p>
<div align="center">
<img src="sttbl.jpg" alt="sttbl.jpg"/>
<p><strong>Figure 2 - State nesting</strong></p></div>
 <hr/>
 <h2><a class="anchor" id="rep2">
Representing the state machine</a></h2>
<p>Now, this section explains how to implement the "my" state machine using the RKH framework, which is shown in <a class="el" href="_usage.html#fig1">Figure 1</a>.</p>
<ol type="1">
<li><a class="el" href="_usage.html#rep_sm">Declaring the state machine (top-state)</a></li>
<li><a class="el" href="_usage.html#rep_cs">Declaring the composite states</a></li>
<li><a class="el" href="_usage.html#rep_bs">Declaring the basic states</a></li>
<li><a class="el" href="_usage.html#rep_cjh">Declaring the pseudostates</a></li>
<li><a class="el" href="_usage.html#rep_st">Declaring transition and branch tables</a></li>
<li><a class="el" href="_usage.html#rep_def">Defining the state machine</a></li>
<li><a class="el" href="_usage.html#rep_act">Declaring and defining actions</a></li>
<li><a class="el" href="_usage.html#rep_inc">Including files</a></li>
</ol>
<p><br/>
 </p>
<h3><a class="anchor" id="rep_sm">
Declaring the state machine (top-state)</a></h3>
<p><br/>
 The object structure of "my" state machine is instantiated by means of <a class="el" href="rkh_8h.html#a290baf778561e431e02c611bb5dd9146" title="This macro creates a state machine object derived from RKH_T.">RKH_CREATE_HSM()</a> macro, which is explained in <b><a class="el" href="rkh_8h.html" title="RKH platform-independent interface.">rkh.h</a></b> file. As noted below, the <code>MYSM_T</code> state machine object is an extension of <a class="el" href="struct_r_k_h___t.html" title="Describes the state machine.">RKH_T</a> structure. Therefore, to do that the <a class="el" href="struct_r_k_h___t.html" title="Describes the state machine.">RKH_T</a> member <code>sm</code> is defined as the FIRST member of the derived struct. The structure definition is in fact entirely encapsulated in its module and is inaccessible to the rest of the application. According to "my" state diagram: <br/>
 <br/>
 </p>
<div class="fragment"><pre class="fragment"><span class="keyword">typedef</span> <span class="keyword">struct</span>
{
    <a class="code" href="struct_r_k_h___t.html" title="Describes the state machine.">RKH_T</a> sm;       <span class="comment">// base structure</span>
    rkhuint8 z;     <span class="comment">// private member</span>
    rkhuint8 w;     <span class="comment">// private member</span>
} MYSM_T;

<a class="code" href="rkh_8h.html#a290baf778561e431e02c611bb5dd9146" title="This macro creates a state machine object derived from RKH_T.">RKH_CREATE_HSM</a>( MYSM_T, my, 0, <a class="code" href="rkh_8h.html#a243967727eeb1814b24badfeda7b25b7af9de2b2b683900d16cf6a78acb458eda">HCAL</a>, &amp;S1, my_init, &amp;mydata );
</pre></div><p> <br/>
 where: <br/>
</p>
<ul>
<li><b>sm_t</b> = <code>"MYSM_T"</code> state machine structure.</li>
<li><b>name</b> = "my". Name of state machine object. Represents the top state of state diagram.</li>
<li><b>id</b> = "0". The numerical value of state machine ID.</li>
<li><b>ppty</b> = "HCAL". Enables the state nesting. The available properties are enumerated in RKH_HPPTY_T enumeration in the <b><a class="el" href="rkh_8h.html" title="RKH platform-independent interface.">rkh.h</a></b> file.</li>
<li><b>is</b> = "S1". Pointer to initial state. This state could be defined either composite or basic.</li>
<li><b>ia</b> = "my_init". Pointer to initialization action. The function prototype is defined as <a class="el" href="rkhitl_8h.html#addede414aa719152174d56d6bd2c7159" title="Initialization action.">RKHINIT_T</a>. This argument is optional, thus it could be declared as NULL.</li>
<li><b>hd</b> = "mydata". Pointer to state-machine's abstract data. This argument is optional, thus it could be declared as NULL or eliminated with RKH_EN_HSM_DATA option. <br/>
 <br/>
 </li>
</ul>
<h3><a class="anchor" id="rep_cs">
Declaring the composite states</a></h3>
<p><br/>
 The <a class="el" href="rkh_8h.html#acc24b2221cd374e66732a09fb24b56ce" title="This macro creates a composite state.">RKH_CREATE_COMP_STATE()</a> macro, which is defined in the <b><a class="el" href="rkh_8h.html" title="RKH platform-independent interface.">rkh.h</a></b> file, is used for creating the composite states. According to "my" state diagram the declaration of composite state "S1" looks as follow:</p>
<div class="fragment"><pre class="fragment"><a class="code" href="rkh_8h.html#acc24b2221cd374e66732a09fb24b56ce" title="This macro creates a composite state.">RKH_CREATE_COMP_STATE</a>( S1, 0, set_y_0, dummy_exit, <a class="code" href="rkh_8h.html#af2b1332a21797445c49710b6074ddb9b" title="This macro indicates the root state of a state machine.">RKH_ROOT</a>, &amp;S11, &amp;DH );
</pre></div><p> <br/>
 where: <br/>
</p>
<ul>
<li><b>name</b> = "S1". State name. Represents a composite state structure.</li>
<li><b>id</b> = "0". The value of state ID.</li>
<li><b>en</b> = "set_y_0". Pointer to state entry action. This argument is optional, thus it could be declared as NULL.</li>
<li><b>ex</b> = "dummy_exit". Pointer to state exit action. This argument is optional, thus it could be declared as NULL.</li>
<li><b>parent</b> = "RKH_ROOT". Pointer to parent state.</li>
<li><b>defchild</b> = "S11". Pointer to default child state or pseudostate.</li>
<li><b>history</b> = "DH". Pointer to history pseudostate. This argument is optional, thus it could be declared as NULL.</li>
</ul>
<p>In like manner, the rest composite states are declared as shown below: <br/>
 </p>
<div class="fragment"><pre class="fragment"><a class="code" href="rkh_8h.html#acc24b2221cd374e66732a09fb24b56ce" title="This macro creates a composite state.">RKH_CREATE_COMP_STATE</a>( S11, 0, NULL, NULL,  &amp;S1,        &amp;S111,  &amp;H );
<a class="code" href="rkh_8h.html#acc24b2221cd374e66732a09fb24b56ce" title="This macro creates a composite state.">RKH_CREATE_COMP_STATE</a>( S3,  0, NULL, NULL,  <a class="code" href="rkh_8h.html#af2b1332a21797445c49710b6074ddb9b" title="This macro indicates the root state of a state machine.">RKH_ROOT</a>,   &amp;S31,   NULL );
</pre></div><p> <br/>
 </p>
<h3><a class="anchor" id="rep_bs">
Declaring the basic states</a></h3>
<p><br/>
 The <a class="el" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE()</a> macro, which is defined in the <b><a class="el" href="rkh_8h.html" title="RKH platform-independent interface.">rkh.h</a></b> file, is used for creating the basic states. According to "my" state diagram the declaration of basic state "S12" looks as follow:</p>
<div class="fragment"><pre class="fragment"><a class="code" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE</a>( S12,    0, set_x_3, NULL, &amp;S1, NULL );
</pre></div><p> <br/>
 where: <br/>
</p>
<ul>
<li><b>name</b> = "S12". State name. Represents the basic state structure.</li>
<li><b>id</b> = "0". The value of state ID.</li>
<li><b>en</b> = "set_x_3". Pointer to state entry action. This argument is optional, thus it could be declared as NULL.</li>
<li><b>ex</b> = "NULL". Pointer to state exit action. This argument is optional, thus it could be declared as NULL.</li>
<li><b>parent</b> = "S1". Pointer to parent state.</li>
<li><b>prepro</b> = "NULL". Pointer to input preprocessor function. This argument is optional, thus it could be declared as NULL. Aditionally, by means of single inheritance in C it could be used as state's abstract data. Aditionally, implementing the single inheritance in C is very simply by literally embedding the base type, RKHPPRO_T in this case, as the first member of the derived structure. <b>Example:</b> </li>
</ul>
<div class="fragment"><pre class="fragment"><span class="keyword">static</span>
<a class="code" href="rkhitl_8h.html#a0bf45cc6ed91f21b3c840d0b29c450b2">RKHE_T</a>
preprocessor( <a class="code" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> *pe )
{
        ...
}

<span class="keyword">typedef</span> <span class="keyword">struct</span>
{
    <a class="code" href="rkhitl_8h.html#a3b113df002d9c5d3422f369fd701ffe3" title="Event preprocessor.">RKHPPRO_T</a> prepro;   <span class="comment">// extend the RKHPPRO_T class</span>
    <span class="keywordtype">unsigned</span> min:4;
    <span class="keywordtype">unsigned</span> max:4;
    <span class="keywordtype">char</span> *buff;
} SDATA_T;
    
<span class="keyword">static</span> <span class="keyword">const</span> SDATA_T option = { preprocessor, 4, 8, token1 };

HUInt
action( <span class="keyword">const</span> <span class="keyword">struct</span> rkh_t *ph, <a class="code" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> *pe )
{
    SDATA_T *popt;

    popt = ( SDATA_T* )<a class="code" href="rkh_8h.html#aafa7b99c6789668667bf529f20bb6c65" title="This macro retrieves the state&amp;#39;s abstract data.">rkh_get_sdata</a>( ph );
    <span class="keywordflow">return</span> popt-&gt;min &gt; 1 &amp;&amp; popt-&gt;max &lt; 4 ? <a class="code" href="rkh_8h.html#a06fc87d81c62e9abb8790b6e5713c55bafe08c2d352ce11183556bab12489e736">RKH_GTRUE</a> : <a class="code" href="rkh_8h.html#a06fc87d81c62e9abb8790b6e5713c55bab2834a90f78254076ef72298dc9e5e95">RKH_GFALSE</a>;
} 

<a class="code" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE</a>( S111, 0, set_x_1, NULL, &amp;S11, preprocessor ); 
<a class="code" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE</a>( S22, 0, set_x_4, NULL, &amp;S2, (<a class="code" href="rkhitl_8h.html#a3b113df002d9c5d3422f369fd701ffe3" title="Event preprocessor.">RKHPPRO_T</a>*)&amp;option ); 
</pre></div><p>In like manner, the rest basic states are declared as shown below: <br/>
 </p>
<div class="fragment"><pre class="fragment"><a class="code" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE</a>( S111,   0, set_x_1, NULL, &amp;S11, NULL );
<a class="code" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE</a>( S112,   0, set_x_2, NULL, &amp;S11, NULL );
<a class="code" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE</a>( S31,    0, NULL,    NULL, &amp;S3,  NULL );
<a class="code" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE</a>( S32,    0, NULL,    NULL, &amp;S3,  NULL );
</pre></div><p> <br/>
 </p>
<h3><a class="anchor" id="rep_cjh">
Declaring the pseudostates</a></h3>
<p><br/>
 The conditional, junction, shallow history, and deep history pseudostates are created using <a class="el" href="rkh_8h.html#ade7387dead9112bd67580de3350aee51" title="This macro creates a conditional pseudostate.">RKH_CREATE_COND_STATE()</a>, <a class="el" href="rkh_8h.html#a9f73c81d95a4bd5bec21e10ea6f05add" title="This macro creates a junction pseudostate.">RKH_CREATE_JUNCTION_STATE()</a>, <a class="el" href="rkh_8h.html#a7a5376dd9929642f5b6e31def6d92bb4" title="This macro creates a shallow history pseudostate.">RKH_CREATE_SHALLOW_HISTORY_STATE()</a>, and <a class="el" href="rkh_8h.html#a49995aa34cddd68fcc6416655ca408f8" title="This macro creates a deep history pseudostate.">RKH_CREATE_DEEP_HISTORY_STATE()</a> macros respectively, which are explained in <b><a class="el" href="rkh_8h.html" title="RKH platform-independent interface.">rkh.h</a></b> file.</p>
<p><br/>
 According to "my" state diagram the declaration of conditional pseudostate "C1" looks as follow: <br/>
 </p>
<div class="fragment"><pre class="fragment"><a class="code" href="rkh_8h.html#ade7387dead9112bd67580de3350aee51" title="This macro creates a conditional pseudostate.">RKH_CREATE_COND_STATE</a>( C1, 0 );
<a class="code" href="rkh_8h.html#ade7387dead9112bd67580de3350aee51" title="This macro creates a conditional pseudostate.">RKH_CREATE_COND_STATE</a>( C2, 0 );
</pre></div><p> <br/>
 where: <br/>
</p>
<ul>
<li><b>name</b> = "C1"/"C2". Pseudostate name. Represents the conditional pseudostate structure.</li>
<li><b>id</b> = "0"/"0". The value of state ID.</li>
</ul>
<p><br/>
 According to "my" state diagram the declaration of juction pseudostate "J" looks as follow: <br/>
 </p>
<div class="fragment"><pre class="fragment"><a class="code" href="rkh_8h.html#a9f73c81d95a4bd5bec21e10ea6f05add" title="This macro creates a junction pseudostate.">RKH_CREATE_JUNCTION_STATE</a>( J, 0, NULL, &amp;S3 );
</pre></div><p> <br/>
 where: <br/>
</p>
<ul>
<li><b>name</b> = "J". Pseudostate name. Represents the junction pseudostate structure.</li>
<li><b>id</b> = "0". The value of state ID.</li>
<li><b>action</b> = "NULL". Pointer to transition action. This argument is optional, thus it could be declared as NULL.</li>
<li><b>target</b> = "S3". Pointer to target state.</li>
</ul>
<p><br/>
 According to "my" state diagram the declaration of shallow history pseudostate "H" looks as follow: <br/>
 </p>
<div class="fragment"><pre class="fragment"><a class="code" href="rkh_8h.html#a7a5376dd9929642f5b6e31def6d92bb4" title="This macro creates a shallow history pseudostate.">RKH_CREATE_SHALLOW_HISTORY_STATE</a>( H, 0, &amp;S11 );
</pre></div><p> <br/>
 where: <br/>
</p>
<ul>
<li><b>name</b> = "H". Pseudostate name. Represents the shallow history pseudostate structure.</li>
<li><b>id</b> = "0". The value of state ID.</li>
<li><b>parent</b> = "S11". Pointer to parent state.</li>
</ul>
<p><br/>
 According to "my" state diagram the declaration of deep history pseudostate "DH" looks as follow: <br/>
 </p>
<div class="fragment"><pre class="fragment"><a class="code" href="rkh_8h.html#a49995aa34cddd68fcc6416655ca408f8" title="This macro creates a deep history pseudostate.">RKH_CREATE_DEEP_HISTORY_STATE</a>( DH, 0, &amp;S1 );
</pre></div><p> <br/>
 where: <br/>
</p>
<ul>
<li><b>name</b> = "DH". Pseudostate name. Represents the deep history pseudostate structure.</li>
<li><b>id</b> = "0". The value of state ID.</li>
<li><b>parent</b> = "S1". Pointer to parent state.</li>
</ul>
<p><br/>
 </p>
<h3><a class="anchor" id="rep_st">
Declaring transition and branch tables</a></h3>
<p><br/>
 The basic and composite states requires a state transition table. The <a class="el" href="rkh_8h.html#aef55bd044383009972f38c332f8210a9">RKH_CREATE_TRANS_TABLE()</a> macro creates a state transition table. Use the <a class="el" href="rkh_8h.html#a0e90290b709c86a39384ea5a4c95ac4f">RKH_END_TRANS_TABLE</a> macro to terminate it. Similarly, the condiotional pseudostates requires a branch table. This <a class="el" href="rkh_8h.html#a57353c7dab6539b0a7ae92142b73ad2e">RKH_CREATE_BRANCH_TABLE</a> macro creates a branch table. Use the <a class="el" href="rkh_8h.html#a179912e226da08c982c9e93d77886c53" title="This macro is used to terminate a state transition table.">RKH_END_BRANCH_TABLE</a> macro to terminate it.</p>
<p><br/>
 According to "my" state diagram the state transition table of state "S2" looks as follow:</p>
<div class="fragment"><pre class="fragment">(1) <a class="code" href="rkh_8h.html#aef55bd044383009972f38c332f8210a9">RKH_CREATE_TRANS_TABLE</a>( S2 )

(2)     <a class="code" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG</a>( ONE,     x_equal_1,  dummy_act,  &amp;S1 ),
(3)     <a class="code" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG</a>( TWO,     NULL,       NULL,       &amp;S2 ),
        <a class="code" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG</a>( THREE,   NULL,       NULL,       &amp;C2 ),
(4)     <a class="code" href="rkh_8h.html#ac257d157f98ef172e5e8c8725a293bdf" title="This macro defines an internal state transition.">RKH_TRINT</a>( FOUR,    NULL,       dummy_act ),
        <a class="code" href="rkh_8h.html#ac257d157f98ef172e5e8c8725a293bdf" title="This macro defines an internal state transition.">RKH_TRINT</a>( SIX,     NULL,       show_data ),

(5) <a class="code" href="rkh_8h.html#a0e90290b709c86a39384ea5a4c95ac4f">RKH_END_TRANS_TABLE</a> 
</pre></div><ul>
<li>(1) Declares the state transition table of state "S2".</li>
</ul>
<ul>
<li>(2) Declares a regular transition using <a class="el" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG()</a> macro. Where:<ul>
<li><b>event</b> = "ONE". Triggering event.</li>
<li><b>guard</b> = "x_equal_1". Pointer to guard function. This argument is optional, thus it could be declared as NULL.</li>
<li><b>action</b> = "dummy_act". Pointer to action function. This argument is optional, thus it could be declared as NULL.</li>
<li><b>target</b> <b>state</b> = "S1". Pointer to target state.</li>
</ul>
</li>
</ul>
<ul>
<li>(3) Declares a regular transition using <a class="el" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG()</a> macro. Note that the RKH implementation supports exclusively the local state transition semantics, that is, a local transition doesn't cause exit from the source state if the target state is a substate of the source. In addition, local state transition doesn't cause exit and reentry to the target state if the target is a superstate of the source state. Where:<ul>
<li><b>event</b> = "TWO". Triggering event.</li>
<li><b>guard</b> = "NULL". Pointer to guard function. This argument is optional, thus it could be declared as NULL.</li>
<li><b>action</b> = "NULL". Pointer to guard function. This argument is optional, thus it could be declared as NULL.</li>
<li><b>target</b> <b>state</b> = "S2". Pointer to target state.</li>
</ul>
</li>
</ul>
<ul>
<li>(4) Declares an internal transition using <a class="el" href="rkh_8h.html#ac257d157f98ef172e5e8c8725a293bdf" title="This macro defines an internal state transition.">RKH_TRINT()</a> macro. Where:<ul>
<li><b>event</b> = "FOUR". Triggering event.</li>
<li><b>guard</b> = "NULL". Pointer to guard function. This argument is optional, thus it could be declared as NULL.</li>
<li><b>action</b> = "dummy_act". Pointer to action function. This argument is optional, thus it could be declared as NULL.</li>
</ul>
</li>
</ul>
<ul>
<li>(4) Terminates the transition table.</li>
</ul>
<p><br/>
 According to "my" state diagram the branch table of "C2" looks as follow:</p>
<div class="fragment"><pre class="fragment">(1) <a class="code" href="rkh_8h.html#a57353c7dab6539b0a7ae92142b73ad2e">RKH_CREATE_BRANCH_TABLE</a>( C2 )
(2)     <a class="code" href="rkh_8h.html#ad1ebb38b7398d7f4ec60ef3e0922d033" title="This macro defines a branch in the branch table.">RKH_BRANCH</a>( x1,         dummy_act,  &amp;S3 ),
        <a class="code" href="rkh_8h.html#ad1ebb38b7398d7f4ec60ef3e0922d033" title="This macro defines a branch in the branch table.">RKH_BRANCH</a>( x2_or_x3,   NULL,       &amp;S32 ),
(3)     <a class="code" href="rkh_8h.html#ad1ebb38b7398d7f4ec60ef3e0922d033" title="This macro defines a branch in the branch table.">RKH_BRANCH</a>( <a class="code" href="rkh_8h.html#a0a70ee0cbf5b1738be4c9463c529ce72">ELSE</a>,       NULL,       &amp;S2 ),
(4) <a class="code" href="rkh_8h.html#a179912e226da08c982c9e93d77886c53" title="This macro is used to terminate a state transition table.">RKH_END_BRANCH_TABLE</a>
</pre></div><ul>
<li>(1) Declares the branch table of state of "C2".</li>
</ul>
<ul>
<li>(2) Declares a branch. Where:<ul>
<li><b>guard</b> = "x1". branch guard.</li>
<li><b>action</b> = "NULL". Pointer to action function. This argument is optional, thus it could be declared as NULL.</li>
<li><b>target</b> <b>state</b> = "S3". Pointer to target state.</li>
</ul>
</li>
</ul>
<ul>
<li>(3) Declares an "else" branch. Each condition connector can have one special branch with a guard labeled ELSE, which is taken if all the guards on the other branches are false.</li>
</ul>
<ul>
<li>(4) Terminates the branch table.</li>
</ul>
<p><br/>
 In like manner, the rest tables are declared as shown below: <br/>
 </p>
<div class="fragment"><pre class="fragment"><span class="comment">/*</span>
<span class="comment">    Defines states and pseudostates.</span>
<span class="comment"> */</span>

<a class="code" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE</a>( S2, 0, NULL, NULL,  <a class="code" href="rkh_8h.html#af2b1332a21797445c49710b6074ddb9b" title="This macro indicates the root state of a state machine.">RKH_ROOT</a>, NULL );
<a class="code" href="rkh_8h.html#aef55bd044383009972f38c332f8210a9">RKH_CREATE_TRANS_TABLE</a>( S2 )

    <a class="code" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG</a>( ONE,     x_equal_1,  dummy_act,  &amp;S1 ),
    <a class="code" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG</a>( TWO,     NULL,       NULL,       &amp;S2 ),
    <a class="code" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG</a>( THREE,   NULL,       NULL,       &amp;C2 ),
    <a class="code" href="rkh_8h.html#ac257d157f98ef172e5e8c8725a293bdf" title="This macro defines an internal state transition.">RKH_TRINT</a>( FOUR,    NULL,       dummy_act ),
    <a class="code" href="rkh_8h.html#ac257d157f98ef172e5e8c8725a293bdf" title="This macro defines an internal state transition.">RKH_TRINT</a>( SIX,     NULL,       show_data ),

<a class="code" href="rkh_8h.html#a0e90290b709c86a39384ea5a4c95ac4f">RKH_END_TRANS_TABLE</a>

<a class="code" href="rkh_8h.html#acc24b2221cd374e66732a09fb24b56ce" title="This macro creates a composite state.">RKH_CREATE_COMP_STATE</a>( S1, 0, set_y_0, dummy_exit,  <a class="code" href="rkh_8h.html#af2b1332a21797445c49710b6074ddb9b" title="This macro indicates the root state of a state machine.">RKH_ROOT</a>, &amp;S11, &amp;DH );
<a class="code" href="rkh_8h.html#aef55bd044383009972f38c332f8210a9">RKH_CREATE_TRANS_TABLE</a>( S1 )

    <a class="code" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG</a>( THREE,   NULL,       NULL,       &amp;S3 ),
    <a class="code" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG</a>( FIVE,    NULL,       NULL,       &amp;S12 ),
    <a class="code" href="rkh_8h.html#ac257d157f98ef172e5e8c8725a293bdf" title="This macro defines an internal state transition.">RKH_TRINT</a>( SIX,     NULL,       show_data ),

<a class="code" href="rkh_8h.html#a0e90290b709c86a39384ea5a4c95ac4f">RKH_END_TRANS_TABLE</a>

<a class="code" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE</a>( S12, 0, set_x_3, NULL, &amp;S1, NULL );
<a class="code" href="rkh_8h.html#aef55bd044383009972f38c332f8210a9">RKH_CREATE_TRANS_TABLE</a>( S12 )

    <a class="code" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG</a>( ONE,     NULL,       NULL,       &amp;J ),
    <a class="code" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG</a>( FOUR,    NULL,       set_y_1,    &amp;S2 ),

<a class="code" href="rkh_8h.html#a0e90290b709c86a39384ea5a4c95ac4f">RKH_END_TRANS_TABLE</a>

<a class="code" href="rkh_8h.html#acc24b2221cd374e66732a09fb24b56ce" title="This macro creates a composite state.">RKH_CREATE_COMP_STATE</a>( S11, 0, NULL, NULL, &amp;S1, &amp;S111, &amp;H );
<a class="code" href="rkh_8h.html#aef55bd044383009972f38c332f8210a9">RKH_CREATE_TRANS_TABLE</a>( S11 )

    <a class="code" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG</a>( TWO,     NULL,       NULL,       &amp;S112 ),
    <a class="code" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG</a>( FOUR,    NULL,       NULL,       &amp;S12 ),

<a class="code" href="rkh_8h.html#a0e90290b709c86a39384ea5a4c95ac4f">RKH_END_TRANS_TABLE</a>

<a class="code" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE</a>( S111, 0, set_x_1, NULL, &amp;S11, NULL );
<a class="code" href="rkh_8h.html#aef55bd044383009972f38c332f8210a9">RKH_CREATE_TRANS_TABLE</a>( S111 )

    <a class="code" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG</a>( ONE,     NULL,       NULL,       &amp;S112 ),

<a class="code" href="rkh_8h.html#a0e90290b709c86a39384ea5a4c95ac4f">RKH_END_TRANS_TABLE</a>

<a class="code" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE</a>( S112, 0, set_x_2, NULL, &amp;S11, NULL );
<a class="code" href="rkh_8h.html#aef55bd044383009972f38c332f8210a9">RKH_CREATE_TRANS_TABLE</a>( S112 )

    <a class="code" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG</a>( ONE,     NULL,       NULL,       &amp;S111 ),
    <a class="code" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG</a>( TWO,     NULL,       NULL,       &amp;S11 ),
    <a class="code" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG</a>( THREE,   NULL,       NULL,       &amp;J ),

<a class="code" href="rkh_8h.html#a0e90290b709c86a39384ea5a4c95ac4f">RKH_END_TRANS_TABLE</a>

<a class="code" href="rkh_8h.html#a7a5376dd9929642f5b6e31def6d92bb4" title="This macro creates a shallow history pseudostate.">RKH_CREATE_SHALLOW_HISTORY_STATE</a>( H, 0, &amp;S11 );
<a class="code" href="rkh_8h.html#a49995aa34cddd68fcc6416655ca408f8" title="This macro creates a deep history pseudostate.">RKH_CREATE_DEEP_HISTORY_STATE</a>( DH, 0, &amp;S1 );

<a class="code" href="rkh_8h.html#acc24b2221cd374e66732a09fb24b56ce" title="This macro creates a composite state.">RKH_CREATE_COMP_STATE</a>( S3, 0, NULL, NULL,  RKH_ROOT, &amp;S31,  NULL );
<a class="code" href="rkh_8h.html#aef55bd044383009972f38c332f8210a9">RKH_CREATE_TRANS_TABLE</a>( S3 )

    <a class="code" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG</a>( TWO,     NULL,       NULL,       &amp;C1 ),
    <a class="code" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG</a>( THREE,   NULL,       NULL,       &amp;S3 ),
    <a class="code" href="rkh_8h.html#ac257d157f98ef172e5e8c8725a293bdf" title="This macro defines an internal state transition.">RKH_TRINT</a>( SIX,     NULL,       show_data ),

<a class="code" href="rkh_8h.html#a0e90290b709c86a39384ea5a4c95ac4f">RKH_END_TRANS_TABLE</a>

<a class="code" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE</a>( S31, 0, NULL, NULL, &amp;S3, NULL );
<a class="code" href="rkh_8h.html#aef55bd044383009972f38c332f8210a9">RKH_CREATE_TRANS_TABLE</a>( S31 )

    <a class="code" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG</a>( ONE,     NULL,       NULL,       &amp;S32 ),

<a class="code" href="rkh_8h.html#a0e90290b709c86a39384ea5a4c95ac4f">RKH_END_TRANS_TABLE</a>

<a class="code" href="rkh_8h.html#a3567a7f91a5dc5759747dc8528357b44" title="This macro creates a basic state.">RKH_CREATE_BASIC_STATE</a>( S32, 0, NULL, NULL, &amp;S3, NULL );
<a class="code" href="rkh_8h.html#aef55bd044383009972f38c332f8210a9">RKH_CREATE_TRANS_TABLE</a>( S32 )

    <a class="code" href="rkh_8h.html#ab0fc2ccb4b73d57ea0c0f478353a00f6" title="This macro defines a regular state transition.">RKH_TRREG</a>( ONE,     NULL,       NULL,       &amp;S31 ),

<a class="code" href="rkh_8h.html#a0e90290b709c86a39384ea5a4c95ac4f">RKH_END_TRANS_TABLE</a>


<a class="code" href="rkh_8h.html#a9f73c81d95a4bd5bec21e10ea6f05add" title="This macro creates a junction pseudostate.">RKH_CREATE_JUNCTION_STATE</a>( J, 0, NULL, &amp;S3 );

<a class="code" href="rkh_8h.html#ade7387dead9112bd67580de3350aee51" title="This macro creates a conditional pseudostate.">RKH_CREATE_COND_STATE</a>( C1, 0 );
<a class="code" href="rkh_8h.html#a57353c7dab6539b0a7ae92142b73ad2e">RKH_CREATE_BRANCH_TABLE</a>( C1 )

    <a class="code" href="rkh_8h.html#ad1ebb38b7398d7f4ec60ef3e0922d033" title="This macro defines a branch in the branch table.">RKH_BRANCH</a>( y1,     NULL,       &amp;H ),
    <a class="code" href="rkh_8h.html#ad1ebb38b7398d7f4ec60ef3e0922d033" title="This macro defines a branch in the branch table.">RKH_BRANCH</a>( y2,     dummy_act,  &amp;DH ),

<a class="code" href="rkh_8h.html#a179912e226da08c982c9e93d77886c53" title="This macro is used to terminate a state transition table.">RKH_END_BRANCH_TABLE</a>

<a class="code" href="rkh_8h.html#ade7387dead9112bd67580de3350aee51" title="This macro creates a conditional pseudostate.">RKH_CREATE_COND_STATE</a>( C2, 0 );
<a class="code" href="rkh_8h.html#a57353c7dab6539b0a7ae92142b73ad2e">RKH_CREATE_BRANCH_TABLE</a>( C2 )

    <a class="code" href="rkh_8h.html#ad1ebb38b7398d7f4ec60ef3e0922d033" title="This macro defines a branch in the branch table.">RKH_BRANCH</a>( x1,         dummy_act,  &amp;S3 ),
    <a class="code" href="rkh_8h.html#ad1ebb38b7398d7f4ec60ef3e0922d033" title="This macro defines a branch in the branch table.">RKH_BRANCH</a>( x2_or_x3,   NULL,       &amp;S32 ),
    <a class="code" href="rkh_8h.html#ad1ebb38b7398d7f4ec60ef3e0922d033" title="This macro defines a branch in the branch table.">RKH_BRANCH</a>( <a class="code" href="rkh_8h.html#a0a70ee0cbf5b1738be4c9463c529ce72">ELSE</a>,       NULL,       &amp;S2 ),

<a class="code" href="rkh_8h.html#a179912e226da08c982c9e93d77886c53" title="This macro is used to terminate a state transition table.">RKH_END_BRANCH_TABLE</a>
</pre></div><h3><a class="anchor" id="rep_inc">
Including files</a></h3>
<p>The following listing shows a fragment of "my.c" source file, which illustatres some aspects of implementing state machines with RKH.</p>
<div class="fragment"><pre class="fragment">(1) #include <span class="stringliteral">&quot;rkh.h&quot;</span>


<span class="comment">/*  Includes file of event definitions. */</span>

(2) #include <span class="stringliteral">&quot;myevt.h&quot;</span>


<span class="comment">/* Includes file of HSM definitions. */</span>

(3) #include <span class="stringliteral">&quot;my.h&quot;</span>


<span class="comment">/* Includes file of action/guard definitions. */</span>

(4) <span class="preprocessor">#include &quot;myact.h&quot;</span>
<span class="preprocessor"></span>

<span class="comment">/* Defines HSM&#39;s data. */</span>

(5) <span class="keyword">static</span> MYHDATA_T mydata;

<span class="comment">/* ... */</span>
</pre></div><ul>
<li>(1) Every application C-file that uses RKH must include the <b><a class="el" href="rkh_8h.html" title="RKH platform-independent interface.">rkh.h</a></b> header file. This header file contains the specific adaptation of RKH to the given processor and compiler, also includes the RKH interface to implement state machines. The port file is located in the application directory.</li>
</ul>
<ul>
<li>(2) The "myevt.h" header file contains the declarations of triggering events shared among the components of the application. This header file is located in the application directory.</li>
</ul>
<ul>
<li>(3) The "my.h" header file contains the definitions of objet structures (state machine, states, and pseudostates) and other facilities shared among the components of the application.</li>
</ul>
<ul>
<li>(4) This header file defines the actions to be executed.</li>
</ul>
<ul>
<li>(5) The "my" state machine maintains its own data in the structure MYDATA_T, which is defined in the "my.h" header file.</li>
</ul>
<p><br/>
 </p>
<h3><a class="anchor" id="rep_def">
Defining the state machine</a></h3>
<p>The following listing shows the "my.h" header file, which illustatres some important aspects of implementing state machines with RKH.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#ifndef __MY_H__</span>
<span class="preprocessor"></span><span class="preprocessor">#define __MY_H__</span>
<span class="preprocessor"></span>

(1) #include <span class="stringliteral">&quot;rkh.h&quot;</span>


<span class="comment">/*  Defines the event structure. */</span>

(2) <span class="keyword">typedef</span> <span class="keyword">struct</span>
    {
(3)     <a class="code" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> event;
(4)     rkhuint16 ts;
    } MYEVT_T;


<span class="comment">/*  Defines the state machine data */</span>

(5) <span class="keyword">typedef</span> <span class="keyword">struct</span>
    {
        rkhuint8 x;
        rkhuint8 y;
    } MYHDATA_T;


<span class="comment">/*  Defines the state machine. */</span>

(6) <a class="code" href="rkh_8h.html#a0681b6c5bbb43a2290ed60b021c2abd1" title="This macro declares a opaque pointer to previously created state machine to be used...">RKH_DCLR_HSM</a>( my );


<span class="comment">/*  Defines states and pseudostates. */</span>

(7) <a class="code" href="rkh_8h.html#ab856423b3e65be3f55b7df3b2984e5fe">RKH_DCLR_COMP_STATE</a>     S1,S3,S11;
    <a class="code" href="rkh_8h.html#a483ad8fd1a11d5b823e58a2884e40f22">RKH_DCLR_BASIC_STATE</a>    S2,S31,S32,S111,S112,S12;
    <a class="code" href="rkh_8h.html#ae15f169feaafe7cf7e335e24e76039b9">RKH_DCLR_COND_STATE</a>     C1,C2;
    <a class="code" href="rkh_8h.html#a2862a673eba565cd2888ca5fb3405a38">RKH_DCLR_JUNC_STATE</a>     J;
    <a class="code" href="rkh_8h.html#a042e46c64f90aa08a92db9e9d30e1959">RKH_DCLR_DHIST_STATE</a>    DH;
    <a class="code" href="rkh_8h.html#aa618e2849fbd748f672bd5e0b3b6bb16">RKH_DCLR_SHIST_STATE</a>    H;


<span class="preprocessor">#endif</span>
</pre></div><ul>
<li>(1) RKH interfaces.</li>
</ul>
<ul>
<li>(2-4) The MYEVT_T structure declares an event with the parameter "ts". Such nesting of structures always aligns the data member <a class="el" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> at the beginning of every instance of the derived structure. In particular, this alignment lets treat a pointer to the derived MYEVT_T structure as a pointer to the <a class="el" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> base structure. Consequently, can always safely pass a pointer to MYEVT_T to any C function that expects a pointer to <a class="el" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a>.</li>
</ul>
<ul>
<li>(5) The MYHDATA_T defines the state machine data.</li>
</ul>
<ul>
<li>(6) Defines the state machine as a global object.</li>
</ul>
<ul>
<li>(7) Defines the states and pseudostates using the corresponding macos listed above: <br/>
 <br/>
<ul>
<li><a class="el" href="rkh_8h.html#ab856423b3e65be3f55b7df3b2984e5fe">RKH_DCLR_COMP_STATE</a>: composite state.</li>
<li><a class="el" href="rkh_8h.html#a483ad8fd1a11d5b823e58a2884e40f22">RKH_DCLR_BASIC_STATE</a>: basic state.</li>
<li><a class="el" href="rkh_8h.html#ae15f169feaafe7cf7e335e24e76039b9">RKH_DCLR_COND_STATE</a>: conditional pseudostate.</li>
<li><a class="el" href="rkh_8h.html#a2862a673eba565cd2888ca5fb3405a38">RKH_DCLR_JUNC_STATE</a>: junction pseudostate.</li>
<li><a class="el" href="rkh_8h.html#a042e46c64f90aa08a92db9e9d30e1959">RKH_DCLR_DHIST_STATE</a>: deep history pseudostate.</li>
<li><a class="el" href="rkh_8h.html#aa618e2849fbd748f672bd5e0b3b6bb16">RKH_DCLR_SHIST_STATE</a>: shallow history pseudostate.</li>
</ul>
</li>
</ul>
<p><br/>
 </p>
<h3><a class="anchor" id="rep_act">
Declaring and defining actions</a></h3>
<p><br/>
 The following enlists the action to be automatically executed by RKH. The function prototypes are explicitly defined in <code><a class="el" href="rkhitl_8h.html" title="RKH engine interface.">rkhitl.h</a></code> file.</p>
<ul>
<li><b>Initiallization</b> <b>action</b> (<a class="el" href="rkhitl_8h.html#addede414aa719152174d56d6bd2c7159" title="Initialization action.">RKHINIT_T</a>): the state transition originating at the black ball is called the initial transition. An initial transition can have associated actions, which RKH invokes to execute the topmost initial transition.</li>
</ul>
<ul>
<li><b>Transition</b> <b>action</b> (<a class="el" href="rkhitl_8h.html#a6774d6792a14179a0955de97a2545dd3" title="Actions.">RKHACT_T</a>): enlists any actions associated with the transition.</li>
</ul>
<ul>
<li><b>Entry</b> <b>action</b> (<a class="el" href="rkhitl_8h.html#ae42800670131f791c8eaa57862224c0e" title="Entry action.">RKHENT_T</a>): this action is executed upon entry to a state.</li>
</ul>
<ul>
<li><b>Exit</b> <b>action</b> (<a class="el" href="rkhitl_8h.html#a175ad93caa689b1f3b02db520a1105c1" title="Exit action.">RKHEXT_T</a>): this action is executed upon exit from a state.</li>
</ul>
<ul>
<li><b>Guard</b> <b>action</b> (<a class="el" href="rkhitl_8h.html#accdcce4dbcbade1d09c11a3484784c68" title="Guard.">RKHGUARD_T</a>): contains the guard conditions attached to transitions.</li>
</ul>
<ul>
<li><b>Preprocessor</b> <b>action</b> (<a class="el" href="rkhitl_8h.html#a3b113df002d9c5d3422f369fd701ffe3" title="Event preprocessor.">RKHPPRO_T</a>): this action is executed before sending occured event to state machine.</li>
</ul>
<p>Aditionally, the preprocessor options listed in <code><a class="el" href="rkhcfg_8h.html" title="RKH configuration file.">rkhcfg.h</a></code> allows to customize the prototypes of each action. See <a class="el" href="cfg.html">Configuration</a> section for more information about that. The used actions in the "my" state machine implementation are shown in <a class="el" href="myact__c.html">"myact.c"</a> file.</p>
<p><br/>
 According to "my" state diagram the initial action looks as follow: <br/>
 </p>
<div class="fragment"><pre class="fragment"><span class="keywordtype">void</span> 
my_init( <span class="keyword">const</span> <span class="keyword">struct</span> rkh_t *ph )
{
    pd = <a class="code" href="rkh_8h.html#a7fe577bfbd5492f9e946a22d1e88c70d" title="This macro retrieves the state-machine&amp;#39;s data.">rkh_get_data</a>( ph );
    pd-&gt;x = pd-&gt;y = 0;
}
</pre></div><p><br/>
 According to "my" state diagram the transition actions looks as follow: <br/>
 </p>
<div class="fragment"><pre class="fragment"><span class="keywordtype">void</span>
set_y_2( <span class="keyword">const</span> <span class="keyword">struct</span> rkh_t *ph, <a class="code" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> *pe )
{
    pd = <a class="code" href="rkh_8h.html#a7fe577bfbd5492f9e946a22d1e88c70d" title="This macro retrieves the state-machine&amp;#39;s data.">rkh_get_data</a>( ph );
    pd-&gt;y = 2;
    printf( <span class="stringliteral">&quot;action: &quot;</span>__FUNCTION__<span class="stringliteral">&quot;()\n&quot;</span> );
    printf( <span class="stringliteral">&quot;event.ts = %05d\n&quot;</span>, (( MYEVT_T* )pe )-&gt;ts );
    printf( <span class="stringliteral">&quot;data.x = %02d - data.y = %02d\n&quot;</span>, pd-&gt;x, pd-&gt;y );
}


<span class="keywordtype">void</span>
set_y_1( <span class="keyword">const</span> <span class="keyword">struct</span> rkh_t *ph, <a class="code" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> *pe )
{
    pd = <a class="code" href="rkh_8h.html#a7fe577bfbd5492f9e946a22d1e88c70d" title="This macro retrieves the state-machine&amp;#39;s data.">rkh_get_data</a>( ph );
    pd-&gt;y = 1;
    printf( <span class="stringliteral">&quot;action: &quot;</span>__FUNCTION__<span class="stringliteral">&quot;()\n&quot;</span> );
    printf( <span class="stringliteral">&quot;event.ts = %05d\n&quot;</span>, (( MYEVT_T* )pe )-&gt;ts );
    printf( <span class="stringliteral">&quot;data.x = %02d - data.y = %02d\n&quot;</span>, pd-&gt;x, pd-&gt;y );
}


<span class="keywordtype">void</span>
dummy_act( <span class="keyword">const</span> <span class="keyword">struct</span> rkh_t *ph, <a class="code" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> *pe )
{
}


<span class="keywordtype">void</span>
show_data( <span class="keyword">const</span> <span class="keyword">struct</span> rkh_t *ph, <a class="code" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> *pe )
{
    pd = <a class="code" href="rkh_8h.html#a7fe577bfbd5492f9e946a22d1e88c70d" title="This macro retrieves the state-machine&amp;#39;s data.">rkh_get_data</a>( ph );
    printf( <span class="stringliteral">&quot;data.x = %02d - data.y = %02d\n&quot;</span>, pd-&gt;x, pd-&gt;y );
}
</pre></div><p><br/>
 According to "my" state diagram the entry actions looks as follow: <br/>
 </p>
<div class="fragment"><pre class="fragment"><span class="keywordtype">void</span>
set_x_1( <span class="keyword">const</span> <span class="keyword">struct</span> rkh_t *ph )
{
    pd = <a class="code" href="rkh_8h.html#a7fe577bfbd5492f9e946a22d1e88c70d" title="This macro retrieves the state-machine&amp;#39;s data.">rkh_get_data</a>( ph );
    pd-&gt;x = 1;
}


<span class="keywordtype">void</span>
set_x_2( <span class="keyword">const</span> <span class="keyword">struct</span> rkh_t *ph )
{
    pd = <a class="code" href="rkh_8h.html#a7fe577bfbd5492f9e946a22d1e88c70d" title="This macro retrieves the state-machine&amp;#39;s data.">rkh_get_data</a>( ph );
    pd-&gt;x = 2;
}


<span class="keywordtype">void</span>
set_x_3( <span class="keyword">const</span> <span class="keyword">struct</span> rkh_t *ph )
{
    pd = <a class="code" href="rkh_8h.html#a7fe577bfbd5492f9e946a22d1e88c70d" title="This macro retrieves the state-machine&amp;#39;s data.">rkh_get_data</a>( ph );
    pd-&gt;x = 3;
}


<span class="keywordtype">void</span>
set_y_0( <span class="keyword">const</span> <span class="keyword">struct</span> rkh_t *ph )
{
    pd = <a class="code" href="rkh_8h.html#a7fe577bfbd5492f9e946a22d1e88c70d" title="This macro retrieves the state-machine&amp;#39;s data.">rkh_get_data</a>( ph );
    pd-&gt;y = 0;
}
</pre></div><p><br/>
 According to "my" state diagram the exit actions looks as follow: <br/>
 </p>
<div class="fragment"><pre class="fragment"><span class="keywordtype">void</span>
dummy_exit( <span class="keyword">const</span> <span class="keyword">struct</span> rkh_t *ph )
{
}
</pre></div><p><br/>
 According to "my" state diagram the guards looks as follow: <br/>
 </p>
<div class="fragment"><pre class="fragment">HUInt
x_equal_1( <span class="keyword">const</span> <span class="keyword">struct</span> rkh_t *ph, <a class="code" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> *pe )
{
    pd = <a class="code" href="rkh_8h.html#a7fe577bfbd5492f9e946a22d1e88c70d" title="This macro retrieves the state-machine&amp;#39;s data.">rkh_get_data</a>( ph );

    <span class="keywordflow">return</span> pd-&gt;x == 1 ? <a class="code" href="rkh_8h.html#a06fc87d81c62e9abb8790b6e5713c55bafe08c2d352ce11183556bab12489e736">RKH_GTRUE</a> : <a class="code" href="rkh_8h.html#a06fc87d81c62e9abb8790b6e5713c55bab2834a90f78254076ef72298dc9e5e95">RKH_GFALSE</a>;
}
</pre></div><p><br/>
 According to "my" state diagram the branch selection functions looks as follow: <br/>
 </p>
<div class="fragment"><pre class="fragment">HUInt
y1( <span class="keyword">const</span> <span class="keyword">struct</span> rkh_t *ph, <a class="code" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> *pe )
{
    pd = <a class="code" href="rkh_8h.html#a7fe577bfbd5492f9e946a22d1e88c70d" title="This macro retrieves the state-machine&amp;#39;s data.">rkh_get_data</a>( ph );
    <span class="keywordflow">return</span> pd-&gt;y == 1 ? <a class="code" href="rkh_8h.html#a06fc87d81c62e9abb8790b6e5713c55bafe08c2d352ce11183556bab12489e736">RKH_GTRUE</a> : <a class="code" href="rkh_8h.html#a06fc87d81c62e9abb8790b6e5713c55bab2834a90f78254076ef72298dc9e5e95">RKH_GFALSE</a>;
}


HUInt
y2( <span class="keyword">const</span> <span class="keyword">struct</span> rkh_t *ph, <a class="code" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> *pe )
{
    pd = <a class="code" href="rkh_8h.html#a7fe577bfbd5492f9e946a22d1e88c70d" title="This macro retrieves the state-machine&amp;#39;s data.">rkh_get_data</a>( ph );
    <span class="keywordflow">return</span> pd-&gt;y == 2 ? <a class="code" href="rkh_8h.html#a06fc87d81c62e9abb8790b6e5713c55bafe08c2d352ce11183556bab12489e736">RKH_GTRUE</a> : <a class="code" href="rkh_8h.html#a06fc87d81c62e9abb8790b6e5713c55bab2834a90f78254076ef72298dc9e5e95">RKH_GFALSE</a>;
}


HUInt
x1( <span class="keyword">const</span> <span class="keyword">struct</span> rkh_t *ph, <a class="code" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> *pe )
{
    pd = <a class="code" href="rkh_8h.html#a7fe577bfbd5492f9e946a22d1e88c70d" title="This macro retrieves the state-machine&amp;#39;s data.">rkh_get_data</a>( ph );
    <span class="keywordflow">return</span> pd-&gt;x == 1 ? <a class="code" href="rkh_8h.html#a06fc87d81c62e9abb8790b6e5713c55bafe08c2d352ce11183556bab12489e736">RKH_GTRUE</a> : <a class="code" href="rkh_8h.html#a06fc87d81c62e9abb8790b6e5713c55bab2834a90f78254076ef72298dc9e5e95">RKH_GFALSE</a>;
}


HUInt
x2_or_x3( <span class="keyword">const</span> <span class="keyword">struct</span> rkh_t *ph, <a class="code" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> *pe )
{
    pd = <a class="code" href="rkh_8h.html#a7fe577bfbd5492f9e946a22d1e88c70d" title="This macro retrieves the state-machine&amp;#39;s data.">rkh_get_data</a>( ph );
    <span class="keywordflow">return</span> pd-&gt;x == 2 || pd-&gt;x == 3 ? <a class="code" href="rkh_8h.html#a06fc87d81c62e9abb8790b6e5713c55bafe08c2d352ce11183556bab12489e736">RKH_GTRUE</a> : <a class="code" href="rkh_8h.html#a06fc87d81c62e9abb8790b6e5713c55bab2834a90f78254076ef72298dc9e5e95">RKH_GFALSE</a>;
}
</pre></div><p><br/>
 After declaring each actions in "myact.c" it must be defined in <a class="el" href="myact__h.html">"myact.h"</a> file.</p>
<hr/>
<h2><a class="anchor" id="rep3">
Running</a></h2>
<p>The following listing shows the main() function implementation. This function is included in the <a class="el" href="main__c.html">"main.c"</a> file, it's located in the application directory.</p>
<div class="fragment"><pre class="fragment">    <span class="keywordtype">void</span>
    main( <span class="keywordtype">void</span> )
    {
        <span class="keywordtype">int</span> c;

(1)     rkh_trace_open();
(2)     <a class="code" href="rkh_8h.html#a48cd2bb428383f544f4eea92f78b7985" title="Inits a previously created state machine calling its initializing function.">rkh_init_hsm</a>( &amp;my );
        srand( ( <span class="keywordtype">unsigned</span> )time( NULL ) );

        forever
        {
(3)         c = mygetch();
        
            <span class="keywordflow">if</span>( c == <span class="charliteral">&#39;p&#39;</span> )
(4)             rkh_trace_flush();
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( c == ESC )
(5)             <span class="keywordflow">break</span>;
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( c == <span class="charliteral">&#39;r&#39;</span> )
                <a class="code" href="rkh_8h.html#a48cd2bb428383f544f4eea92f78b7985" title="Inits a previously created state machine calling its initializing function.">rkh_init_hsm</a>( &amp;my );
            <span class="keywordflow">else</span>
            {
(6)             mye.event = kbmap( c );
(7)             mye.ts = ( rkhuint16 )rand();
(8)             <a class="code" href="rkh_8h.html#a380f0c7ce60d43d96b7963d12f4aae55" title="Executes a state machine in a non-preemtive model.">rkh_engine</a>( &amp;my, ( <a class="code" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> *)&amp;mye );
            }
        }

(9)     rkh_trace_close();
    }
</pre></div><ul>
<li>(1) Initialize the RKH trace module.</li>
</ul>
<ul>
<li>(2) Initialize the "my" state machine. RKH invokes the my_init() function.</li>
</ul>
<ul>
<li>(3) Gets key pressed from the standard input.</li>
</ul>
<ul>
<li>(4) Flushs the trace stream to the desired host.</li>
</ul>
<ul>
<li>(5) Terminates the program.</li>
</ul>
<ul>
<li>(6) The event generated by pressing a key on the keyboard is stored in the "event" member of MYEVT_T structure.</li>
</ul>
<ul>
<li>(7) The event has associated parameters that convey a random number.</li>
</ul>
<ul>
<li>(8) Events with parameters, such as the MYEVT_T, require explicit casting from the generic base structure <a class="el" href="struct_r_k_h_e_v_t___t.html" title="Represents events without parameters.">RKHEVT_T</a> to the specific derived structure MYEVT_T.</li>
</ul>
<ul>
<li>(9) Terminates the program and close debug session. </li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Mon Jul 4 09:15:47 2011 for RKH by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
